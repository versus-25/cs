**env** - все переменные окружения  
файл **~/.bashrc** переменные пользователя считывается только при создании сессии source с этим файлом перезаписывает переменные в текущей сессии
**~/.bash_history** история баша юзера - не сохраняет команды с пробелом или # в начале  

**reset** - перезагрузка терминала  а не сессии  
**!!** повтор прошлой команды  


ps ax -o pid,user --sort=-%mem сортировка по памяти
**shopt** - настройка shell  
**type** <command> тип команды, например shell built-in - type -a <comand> все вариации команды  
**shell built-in** команды встроенные в оболочку, не порождают дочерних процессов. Весь список смотреть через compgen.  
**echo $PAT** переменные среды, директории, где идет поиск команд, например /bin  
**man 3 printf** - открывается 3 страница man  
man -k <keyword>  
man -P <pager>  
bc - калькулятор и можно передать строку для выполнения

**lsof**  list open files  
**псевдофайловые системы** - не хранится на физическом накопителе
/dev виртуальное представление устройств
/proc виртуальное представление структур ядра
  
стандартные потоки - атрибут процесса, их можно перенаправлять, например ```bash 2>/dev/null```
```ls -l /root /tmp >/tmp/ls 2>&1``` - перенаправить stdin в /tmp/ls и stderr в первый поток(стандартный вывод &1) Читается сначала перенаправление, оп порядку слева направо
если какой-то файл открыт каким-то процессом и удален, то пока есть процесс файл доступен через поток, используемый процессом.
Пример восстановления ```cp /proc/1608/fd/3 /tmp/file``` fd - file descriptor перенаправляем файловый дескриптор в файл

TTY эмулятор терминала
PTY псевдоэмулятор терминала
/dev/ptmx PTY-мастер, одно виртуальное устройство, при обращении к нему оно выделяет
/dev/pts/x PTY-slave потом каждое устройство /dev/pts/x передает события вроде ввода с клавиатуры на /dev/ptmx или /dev/pts/x Те мастер проксирует обмен данными(одно устройство) с другими устройствами или терминалами

  
 
  
  
#OS
**Unix** - os разработанная в 70х
**POSIX** portable operating system interface - стандрат для ос.
Задачи ос 
1. организация процесса загрузки, runtime - системные либы, виртуальные машины  и тд
2. Интерфейс для работы с оборудованием - абстракция, позволяющая по не работать с оборудованием напрямую
3. Виртуализация и планирование использования ресурсов.
4. Передача данных локально между приложениями
5. Поддержка многопользовательского режима 
6. Виртуализация устройств
  <img width="463" alt="Снимок экрана 2022-11-20 в 14 58 53" src="https://user-images.githubusercontent.com/53166911/202898504-221e8a81-5cb0-4833-b1ef-9e5fe7f3ce57.png">
**user space** - часть для пользовательских приложений    
**kernel space** - часть для ядра - модули ядра, драйверы,управление памятью,     
**gnu c library glibc** - стандартная библиотека линукс, к нй образаются юз приложения, чтобы упростить работу с системными вызовами     
библиотечные вызовы пример libc write()  
strace или sotruss    
```strace -p $(pgrep -f 'nginx')``` подключиться к pid процесса.   

strace -f bash -c 'date' - вызов вместе с дочерними процессами, иначе дочерний процесс date не будет в результатах    
  
**Создание процессов** происходит с помощью системных вызовов fork() vfork и тд. Процесс форкается и получается два процесса которые возвращают PID, если пид новый, то это дочерний процесс, если старый(тот же) - это родитель. 
  <img width="881" alt="Снимок экрана 2022-11-25 в 18 53 42" src="https://user-images.githubusercontent.com/53166911/204010328-caf2a0ba-5e38-4986-ab48-d655a8da2fc1.png">
  ### Состояния процессов:
  - D - uninteruptable sleep(непрерываемый сон) обычно в io операциях
  - S - interaptable sleep обычный сон, может быть прерван, ожидает какого-то события
  - R - running исполняется или ожидает исполнения
  - T - остановлен сигналом выполнения задач
  - Z - зомби процесс, занимает пространство PID
  
 > **uptime** - load average за 1, 5, 15 минут  
 **load average** время процессов за интервал времени. Так как входит D то это значит что например ожидание oi операции также входит в это время.  
  
cat /proc/pressure/{cpu, io, memory} сведения о загрузке процессора  

### сигналы
kill - по дефолту отправляет SIGTERM
kill -HUP для перечитывания конфига
  

### Система
lsb_release -a - версия системы линукс  
cat /boot/config* - файл с настройками ядра  
  
### Модули ядра
modprobe - загрузка модулей ядра  
cat /etc/default/grub настройки ядра  
sysctl -a покажет все параметры ядра
sysctl -w net.ipv4.ip_forward=1 меняем параметр на 1, после перезагрузки пропадет.  
настройки сохраняются в /etc/sysctl.d  

  
dmesg - реакция ядра на проблемы/логи ядра  
/var/log/syslog вывод системных демонов  

  
### Система инициализация ядра
systemd  
systemctl list-units --all все юниты  
sysctl cat nginx показывает настройки сервиса  
sysctl edit --full nginx отредактировать сервис  
journalctl - все логи юнитов  

  
### NAmespaces - основа контейнеризации
lsns - просмотреть все неймспейсы
контейнер это неймспейс с ограниченными ресурсами  
unshare -f --pid --mount-proc /bin/bash - создать аналог контейнера или новый неймспейс с примонтированным диском и пидом  




#### Файловые системы
stat filename  все о файле
lsblk файловые устройства 
MAJ:MIN -major:minor major - диск, min - раздел диска(тоже самое, что в stat Device, только не в HEX)
в поддерреве видно поддиректории lvm  

links - жесткие ссылки hard link, не занимает inode ln, не копирует физические данные, только ссылается на файл, даже если удалить изначальный файл, то при наличиии ссылок данные будут храниться и доступны.  
sim link/ soft link занимает новый inode, при изменении прав доступа на файл доступ по ссылке остается(разные права доступа на файл и ссылку), содержит только имя файла, а не его содержимое(можно ссылаться на разные файловые системы)
найти все ссылки на файл
ls -li filename дает inode
find / -inum inode  дает все ссылки на файл  
cat /sys/block/queue/physical_block_size размер физического блока диска
xfs - файловая система с динамическим изменением количества доступных inode(обычно можно указать только при создании файловой системы)  
##### типы файлов  
regular file  
directory  
symlink  
pipe - именованный пайп(| - неименованный)  stat покажет тип fifo. Можно записывать из нескольких процессов.  
socket - файл для межпроцессного взаимодействия - локального или сетевого(как pipe, только быстрее, двунаправленный, отслеживает, кто записал)  

##### Права доступа  
ugo - владелец/группа владельца/все юзеры  
rwx - чтение/запись/исполнение  
x для директорий можно делать chdir/cd  

umask user mask пользовательская маска вычитает маску из прав
пример стандарт для файлов 0777  
для директорий 0666
При создании под **рутом** дефолт будет 0777 - 0022 = 0755 для файлов и 0666 - 0022 = 0644 для директорий
При создании под **нерутом** дефолт будет 0777 - 0002 = 0775 для файлов и 0666 - 0002 = 0664 для директорий  
Дополнительные права (0 для 0777)  
setuid - установить userid
setgid - установить group id  
sticky - изменить файл может только тот пользователь, который записал файл. 
setuid setgid - (для исполняемых файлов)позволяет запущенному процессу получить права **владельца файла** а не юзера, запустившего процесс, а не права процесса  
пример - passwd пользователь может поменять строчку в /etc/shadow для своего пароля

#### Дополнительные атрибуты файла  
например -  -i - imutable, сделать файл неизменяемым
lsattr - смотреть атрибуты
chattr - изменить атрибуты
  
  
#### Хранение данных  
<img width="422" alt="Снимок экрана 2022-12-19 в 20 06 06" src="https://user-images.githubusercontent.com/53166911/208469225-53af4c3d-661e-45f5-905e-ba4004d3f768.png">
  
fdisk -l /dev/sda данные о диске  
vgs  
RAID0 - делим данные пополам(скорость)  
RAID1 - дублируем данные(отказоустойчивость)  
mdadm - создание программного raid  
  
mdadm Создаем рейд
mkfs.ext4 Создаем файловую сисетму  
mount монтируем к точке монтирования  
  
sfdisk 
fdisk просмотр и создание таблиц разделов дисков  
/etc/fstab - данные о файловых системах man 5 fstab  

  
## Сети  
1. **A**ll - Application
2. **P**eople - Presentation
3. **S**eem - Session
4. **T**o - Transport
5. **N**eed - Network
6. **D**ata - Data link
7. **P**rocessing Phisical
